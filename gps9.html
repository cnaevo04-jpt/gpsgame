<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å›½é“å†’é™ºè¨˜ - ãƒãƒƒãƒ—</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f4f7;
            color: #333;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        .map-container {
            flex-grow: 1;
            position: relative;
            background-color: #a3c4f3;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .user-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 16px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            font-size: 0.85em;
            display: flex;
            gap: 15px;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .user-info .points, .user-info .progress {
            display: flex;
            align-items: center;
            font-weight: 600;
        }
        .user-info .icon {
            width: 18px;
            height: 18px;
            margin-right: 6px;
        }
        
        .road-info {
            position: absolute;
            top: 80px;
            left: 20px;
            background: rgba(76, 175, 80, 0.95);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            font-size: 0.85em;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
            animation: slideInLeft 0.3s ease;
        }
        
        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .gps-status {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .gps-status.success { color: #28a745; background: rgba(212, 237, 218, 0.95); }
        .gps-status.loading { color: #ffc107; background: rgba(255, 243, 205, 0.95); }
        .gps-status.error { color: #dc3545; background: rgba(248, 215, 218, 0.95); }
        
        .navbar {
            display: flex;
            justify-content: space-around;
            background-color: #fff;
            padding: 10px 0;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        .nav-item {
            text-align: center;
            flex: 1;
            text-decoration: none;
            color: #888;
            transition: color 0.2s;
            padding: 5px;
        }
        .nav-item.active { color: #4a90e2; }
        .nav-item:hover { color: #4a90e2; }
        .nav-item .nav-icon {
            height: 24px;
            width: 24px;
            display: block;
            margin: 0 auto 5px;
        }
        .nav-item span { font-size: 0.8em; }
        
        .map-controls {
            position: absolute;
            bottom: 100px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }
        
        .control-button {
            background: rgba(255, 255, 255, 0.95);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 25px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
        }
        
        .control-button:hover { transform: scale(1.05); }
        
        .debug-panel {
            position: absolute;
            bottom: 100px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            padding: 10px;
            border-radius: 8px;
            max-width: 250px;
            max-height: 120px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <div class="map-container">
        <div id="map"></div>
        
        <div class="user-info">
            <div class="points">
                <span class="icon">ğŸ’</span>
                <span id="pointsDisplay">12500</span>
            </div>
            <div class="progress">
                <span class="icon">ğŸ“</span>
                <span id="distanceDisplay">0km</span>
            </div>
        </div>
        
        <div class="road-info" id="roadInfo" style="display: none;">
            <div id="roadName">å›½é“ã‚’æ¤œç´¢ä¸­...</div>
            <div id="roadDistance">èµ°è¡Œè·é›¢: 0m</div>
        </div>
        
        <div class="gps-status loading" id="gpsStatus">ğŸ“¡ GPSå–å¾—ä¸­...</div>
        
        <div class="map-controls">
            <button class="control-button" onclick="getCurrentLocation()" title="ç¾åœ¨åœ°å–å¾—">ğŸ“</button>
            <button class="control-button" onclick="toggleLocationWatch()" id="watchButton" title="ä½ç½®ç›£è¦–">ğŸ‘ï¸</button>
            <button class="control-button" onclick="startSimulation()" id="simulateButton" title="ç§»å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³">ğŸš—</button>
            <button class="control-button" onclick="toggleDebug()" title="ãƒ‡ãƒãƒƒã‚°">ğŸ”§</button>
        </div>
        
        <div class="debug-panel" id="debugPanel">
            <div id="debugLog">GPSæƒ…å ±èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
    </div>
    
    <nav class="navbar">
        <a href="#" class="nav-item active">
            <span class="nav-icon">ğŸ—ºï¸</span>
            <span>ãƒãƒƒãƒ—</span>
        </a>
        <a href="character" class="nav-item">
            <span class="nav-icon">ğŸ‘¥</span>
            <span>ã‚­ãƒ£ãƒ©å›³é‘‘</span>
        </a>
        <a href="travel_history" class="nav-item">
            <span class="nav-icon">ğŸ“Š</span>
            <span>èµ°è¡Œå±¥æ­´</span>
        </a>
        <a href="#" class="nav-item">
            <span class="nav-icon">â¤ï¸</span>
            <span>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</span>
        </a>
        <a href="#" class="nav-item">
            <span class="nav-icon">âš™ï¸</span>
            <span>è¨­å®š</span>
        </a>
    </nav>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
        let map = null;
        let currentMarker = null;
        let watchId = null;
        let isWatching = false;
        let debugMode = false;
        let debugLog = [];
        let currentLocation = null;
        let roadLayer = null;
        
        // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿
        let gameData = {
            points: 12500,
            totalDistance: 0,
            lastPosition: null,
            currentRoad: null,
            roadDistance: 0
        };
        
        // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨å¤‰æ•°
        let simulationActive = false;
        let simulationInterval = null;
        
        // å¤§é˜ªã®å›½é“ãƒ†ã‚¹ãƒˆãƒã‚¤ãƒ³ãƒˆ
        const testPoints = [
            { lat: 34.7024, lng: 135.4959, name: "å¤§é˜ªé§…" },
            { lat: 34.7030, lng: 135.4970, name: "å›½é“1å· Point1" },
            { lat: 34.7040, lng: 135.4980, name: "å›½é“1å· Point2" },
            { lat: 34.6900, lng: 135.4950, name: "ä¸­ä¹‹å³¶å…¬åœ’" },
            { lat: 34.6910, lng: 135.4960, name: "å›½é“2å· Point1" },
            { lat: 34.6920, lng: 135.4970, name: "å›½é“2å· Point2" },
            { lat: 34.6500, lng: 135.5150, name: "å¤©ç‹å¯ºé§…" },
            { lat: 34.6510, lng: 135.5160, name: "å›½é“25å· Point1" },
            { lat: 34.6520, lng: 135.5170, name: "å›½é“25å· Point2" },
            { lat: 34.7250, lng: 135.4900, name: "æ–°å¤§é˜ªé§…" },
            { lat: 34.7260, lng: 135.4910, name: "å›½é“176å· Point1" },
            { lat: 34.7270, lng: 135.4920, name: "å›½é“176å· Point2" }
        ];
        
        let currentTestIndex = 0;
        
        // å›½é“1å·ã‚’æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿ã§æç”»
        function drawRoute1WithRealData() {
            if (!map) return;
            
            // å›½é“1å·ã®å®Ÿéš›ã®ãƒ«ãƒ¼ãƒˆï¼ˆä¸»è¦ãƒã‚¤ãƒ³ãƒˆï¼‰
            const route1Points = [
                [35.6762, 139.6503], // æ±äº¬é§…ï¼ˆèµ·ç‚¹ï¼‰
                [35.6280, 139.7394], // å“å·
                [35.4478, 139.6425], // æ¨ªæµœ
                [35.3606, 139.6394], // è—¤æ²¢
                [35.0844, 138.9086], // æ²¼æ´¥
                [34.9756, 138.3829], // é™å²¡å¸‚
                [34.8886, 137.9378], // æµœæ¾
                [35.1802, 136.9066], // åå¤å±‹
                [34.9858, 135.7581], // äº¬éƒ½
                [34.7024, 135.4959]  // å¤§é˜ªï¼ˆçµ‚ç‚¹ï¼‰
            ];
            
            const isCompleted = JSON.parse(localStorage.getItem('unlockedCharacters') || '[]').includes(1);
            const color = isCompleted ? '#4CAF50' : '#FF0000';
            
            // æ—¢å­˜ã®ç·šãŒã‚ã‚Œã°å‰Šé™¤
            if (roadLayer) {
                map.removeLayer(roadLayer);
            }
            
            roadLayer = L.polyline(route1Points, {
                color: color,
                weight: 6,
                opacity: 0.8,
                dashArray: isCompleted ? null : '10, 5'
            }).addTo(map);
            
            roadLayer.bindPopup(`
                <div style="text-align: center; font-weight: bold;">
                    <strong>å›½é“1å·ï¼ˆæ±æµ·é“ï¼‰</strong><br>
                    <span style="color: ${color};">
                        ${isCompleted ? 'âœ… èµ°è¡Œæ¸ˆã¿' : 'âŒ æœªèµ°è¡Œ'}
                    </span><br>
                    <small>æ±äº¬-å¤§é˜ªé–“ ç´„500km</small>
                </div>
            `);
            
            // åœ°å›³ã‚’å›½é“1å·å…¨ä½“ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«èª¿æ•´
            map.fitBounds(route1Points, { padding: [20, 20] });
            
            addDebugLog('å›½é“1å·ç·šã‚’æç”»ã—ã¾ã—ãŸï¼ˆæ‰‹å‹•ãƒ‡ãƒ¼ã‚¿ï¼‰');
        }
        
        // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°
        function addDebugLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.push(`[${timestamp}] ${message}`);
            if (debugLog.length > 15) debugLog.shift();
            console.log(`[GPS-GAME] ${message}`);
            updateDebugDisplay();
        }
        
        function updateDebugDisplay() {
            if (debugMode) {
                const debugElement = document.getElementById('debugLog');
                debugElement.innerHTML = `
                    ${debugLog.join('<br>')}
                    <br><br><strong>ğŸ® ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½:</strong><br>
                    <button onclick="jumpToRoad(1)" style="margin:2px;padding:4px;font-size:10px;">å›½é“1å·</button>
                    <button onclick="jumpToRoad(2)" style="margin:2px;padding:4px;font-size:10px;">å›½é“2å·</button><br>
                    <button onclick="jumpToRoad(25)" style="margin:2px;padding:4px;font-size:10px;">å›½é“25å·</button>
                    <button onclick="jumpToRoad(176)" style="margin:2px;padding:4px;font-size:10px;">å›½é“176å·</button><br>
                    <button onclick="drawRoute1WithRealData()" style="margin:2px;padding:4px;font-size:10px;background:#4CAF50;color:white;">å›½é“1å·ç·šæç”»</button>
                `;
            }
        }
        
        function toggleDebug() {
            debugMode = !debugMode;
            document.getElementById('debugPanel').style.display = debugMode ? 'block' : 'none';
            if (debugMode) updateDebugDisplay();
        }
        
        // GPSçŠ¶æ…‹æ›´æ–°
        function updateGpsStatus(status, message) {
            const statusElement = document.getElementById('gpsStatus');
            statusElement.className = `gps-status ${status}`;
            statusElement.textContent = message;
        }
        
        // åœ°å›³åˆæœŸåŒ–
        function initMap(lat = 34.7024, lng = 135.4959) {
            addDebugLog('åœ°å›³åˆæœŸåŒ–é–‹å§‹');
            
            try {
                if (map) {
                    map.remove();
                    map = null;
                }
                
                const mapElement = document.getElementById('map');
                mapElement.innerHTML = '';
                
                map = L.map('map').setView([lat, lng], 15);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Â© OpenStreetMap contributors',
                    maxZoom: 19
                }).addTo(map);
                
                addDebugLog('åœ°å›³åˆæœŸåŒ–å®Œäº†');
                
            } catch (error) {
                addDebugLog('åœ°å›³ã‚¨ãƒ©ãƒ¼: ' + error.message);
                updateGpsStatus('error', 'âŒ åœ°å›³ã‚¨ãƒ©ãƒ¼');
                
                const mapElement = document.getElementById('map');
                mapElement.innerHTML = `
                    <div style="width: 100%; height: 100%; background: #74b9ff; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ—ºï¸</div>
                        <div style="font-weight: bold;">åœ°å›³èª­ã¿è¾¼ã¿ä¸­...</div>
                        <button onclick="initMap()" style="margin-top: 20px; padding: 10px 20px; background: white; color: #333; border: none; border-radius: 5px; cursor: pointer;">å†èª­ã¿è¾¼ã¿</button>
                    </div>
                `;
            }
        }
        
        // ç¾åœ¨åœ°ãƒãƒ¼ã‚«ãƒ¼æ›´æ–°
        function updateCurrentLocationMarker(lat, lng, accuracy) {
            if (!map) return;
            
            if (currentMarker) map.removeLayer(currentMarker);
            
            currentMarker = L.marker([lat, lng], {
                icon: L.divIcon({
                    className: 'current-location-marker',
                    html: 'ğŸ“',
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                })
            }).addTo(map);
            
            L.circle([lat, lng], {
                color: '#4a90e2',
                fillColor: '#4a90e2',
                fillOpacity: 0.1,
                radius: accuracy
            }).addTo(map);
            
            currentMarker.bindPopup(`ç¾åœ¨åœ°<br>ç²¾åº¦: ${accuracy.toFixed(1)}m`);
        }
        
        // è·é›¢è¨ˆç®—
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371000;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        // å›½é“åˆ¤å®š
        function checkNationalRoad(lat, lng) {
            const roads = [
                { id: 1, name: "å›½é“1å·", minLat: 34.700, maxLat: 34.710, minLng: 135.495, maxLng: 135.505 },
                { id: 2, name: "å›½é“2å·", minLat: 34.685, maxLat: 34.695, minLng: 135.490, maxLng: 135.500 },
                { id: 25, name: "å›½é“25å·", minLat: 34.645, maxLat: 34.655, minLng: 135.510, maxLng: 135.520 },
                { id: 176, name: "å›½é“176å·", minLat: 34.720, maxLat: 34.730, minLng: 135.485, maxLng: 135.495 }
            ];
            
            for (let road of roads) {
                if (lat >= road.minLat && lat <= road.maxLat && lng >= road.minLng && lng <= road.maxLng) {
                    return road;
                }
            }
            return null;
        }
        
        // ã‚²ãƒ¼ãƒ é€²è¡Œå‡¦ç†
        function processGameData(lat, lng) {
            if (gameData.lastPosition) {
                const distance = calculateDistance(gameData.lastPosition.lat, gameData.lastPosition.lng, lat, lng);
                if (distance > 1 && distance < 200) {
                    gameData.totalDistance += distance;
                    gameData.points += Math.floor(distance / 10);
                    
                    if (gameData.currentRoad) {
                        gameData.roadDistance += distance;
                    }
                    
                    document.getElementById('distanceDisplay').textContent = `${(gameData.totalDistance/1000).toFixed(1)}km`;
                    document.getElementById('pointsDisplay').textContent = gameData.points.toLocaleString();
                    
                    if (gameData.currentRoad) {
                        document.getElementById('roadDistance').textContent = `èµ°è¡Œè·é›¢: ${gameData.roadDistance.toFixed(0)}m`;
                    }
                    
                    addDebugLog(`ç§»å‹•è·é›¢: ${distance.toFixed(1)}m (ç·è¨ˆ: ${(gameData.totalDistance/1000).toFixed(2)}km)`);
                }
            }
            
            const road = checkNationalRoad(lat, lng);
            if (road) {
                if (!gameData.currentRoad || gameData.currentRoad.id !== road.id) {
                    gameData.currentRoad = road;
                    gameData.roadDistance = 0;
                    document.getElementById('roadName').textContent = `ğŸ›£ï¸ ${road.name}`;
                    document.getElementById('roadDistance').textContent = `èµ°è¡Œè·é›¢: 0m`;
                    document.getElementById('roadInfo').style.display = 'block';
                    addDebugLog(`å›½é“ç™ºè¦‹: ${road.name}`);
                } else {
                    document.getElementById('roadDistance').textContent = `èµ°è¡Œè·é›¢: ${gameData.roadDistance.toFixed(0)}m`;
                }
            } else {
                if (gameData.currentRoad) {
                    addDebugLog(`${gameData.currentRoad.name}ã‚’é›¢è„± (èµ°è¡Œè·é›¢: ${gameData.roadDistance.toFixed(0)}m)`);
                    gameData.currentRoad = null;
                    gameData.roadDistance = 0;
                    document.getElementById('roadInfo').style.display = 'none';
                    addDebugLog('å›½é“ã‹ã‚‰é›¢ã‚Œã¾ã—ãŸ');
                }
            }
            
            gameData.lastPosition = { lat, lng };
        }
        
        // ä½ç½®æƒ…å ±å–å¾—æˆåŠŸ
        function onLocationSuccess(position) {
            const { latitude, longitude, accuracy } = position.coords;
            
            currentLocation = { latitude, longitude, accuracy };
            updateGpsStatus('success', `ğŸ“ GPSç²¾åº¦: ${accuracy.toFixed(0)}m`);
            updateCurrentLocationMarker(latitude, longitude, accuracy);
            
            processGameData(latitude, longitude);
            
            if (!isWatching) {
                map.setView([latitude, longitude], 16);
            }
            
            addDebugLog(`ä½ç½®å–å¾—: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`);
        }
        
        // ä½ç½®æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼
        function onLocationError(error) {
            let message = '';
            switch(error.code) {
                case error.PERMISSION_DENIED: message = 'âŒ ä½ç½®æƒ…å ±ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ'; break;
                case error.POSITION_UNAVAILABLE: message = 'âŒ ä½ç½®æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“'; break;
                case error.TIMEOUT: message = 'â° ä½ç½®æƒ…å ±å–å¾—ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ'; break;
                default: message = 'âŒ ä½ç½®æƒ…å ±ã‚¨ãƒ©ãƒ¼';
            }
            updateGpsStatus('error', message);
            addDebugLog('GPS ã‚¨ãƒ©ãƒ¼: ' + error.message);
        }
        
        // ç¾åœ¨åœ°å–å¾—
        function getCurrentLocation() {
            if (!navigator.geolocation) {
                updateGpsStatus('error', 'âŒ GPSéå¯¾å¿œ');
                return;
            }
            
            updateGpsStatus('loading', 'ğŸ“¡ ä½ç½®å–å¾—ä¸­...');
            
            navigator.geolocation.getCurrentPosition(
                onLocationSuccess,
                onLocationError,
                { enableHighAccuracy: true, timeout: 15000, maximumAge: 5000 }
            );
        }
        
        // ä½ç½®ç›£è¦–åˆ‡ã‚Šæ›¿ãˆ
        function toggleLocationWatch() {
            const button = document.getElementById('watchButton');
            
            if (isWatching) {
                if (watchId) navigator.geolocation.clearWatch(watchId);
                isWatching = false;
                button.textContent = 'ğŸ‘ï¸';
                updateGpsStatus('success', 'â¹ï¸ ç›£è¦–åœæ­¢');
                addDebugLog('ä½ç½®ç›£è¦–åœæ­¢');
            } else {
                watchId = navigator.geolocation.watchPosition(
                    onLocationSuccess,
                    onLocationError,
                    { enableHighAccuracy: true, timeout: 10000, maximumAge: 3000 }
                );
                isWatching = true;
                button.textContent = 'â¹ï¸';
                updateGpsStatus('loading', 'ğŸ‘ï¸ ä½ç½®ç›£è¦–ä¸­...');
                addDebugLog('ä½ç½®ç›£è¦–é–‹å§‹');
            }
        }
        
        // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
        function startSimulation() {
            const button = document.getElementById('simulateButton');
            
            if (simulationActive) {
                clearInterval(simulationInterval);
                simulationActive = false;
                button.textContent = 'ğŸš—';
                button.title = 'ç§»å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³';
                updateGpsStatus('success', 'â¹ï¸ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åœæ­¢');
                addDebugLog('ç§»å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åœæ­¢');
            } else {
                simulationActive = true;
                button.textContent = 'â¹ï¸';
                button.title = 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åœæ­¢';
                updateGpsStatus('loading', 'ğŸš— ç§»å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸­...');
                addDebugLog('ç§»å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹');
                
                simulationInterval = setInterval(simulateMovement, 3000);
                simulateMovement();
            }
        }
        
        function simulateMovement() {
            if (!simulationActive) return;
            
            const point = testPoints[currentTestIndex];
            const lat = point.lat + (Math.random() - 0.5) * 0.0001;
            const lng = point.lng + (Math.random() - 0.5) * 0.0001;
            const accuracy = 10 + Math.random() * 20;
            
            const simulatedPosition = {
                coords: { latitude: lat, longitude: lng, accuracy: accuracy, speed: 5 },
                timestamp: Date.now()
            };
            
            onLocationSuccess(simulatedPosition);
            addDebugLog(`ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: ${point.name} (${lat.toFixed(6)}, ${lng.toFixed(6)})`);
            
            currentTestIndex = (currentTestIndex + 1) % testPoints.length;
            
            if (currentTestIndex === 0) {
                addDebugLog('ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³1å‘¨å®Œäº†ã€ç¶™ç¶šä¸­...');
            }
        }
        
        function jumpToRoad(roadNumber) {
            let targetPoint;
            switch(roadNumber) {
                case 1: targetPoint = { lat: 34.7035, lng: 135.4975, name: "å›½é“1å·ãƒ†ã‚¹ãƒˆåœ°ç‚¹" }; break;
                case 2: targetPoint = { lat: 34.6915, lng: 135.4965, name: "å›½é“2å·ãƒ†ã‚¹ãƒˆåœ°ç‚¹" }; break;
                case 25: targetPoint = { lat: 34.6515, lng: 135.5165, name: "å›½é“25å·ãƒ†ã‚¹ãƒˆåœ°ç‚¹" }; break;
                case 176: targetPoint = { lat: 34.7265, lng: 135.4915, name: "å›½é“176å·ãƒ†ã‚¹ãƒˆåœ°ç‚¹" }; break;
                default: return;
            }
            
            const simulatedPosition = {
                coords: { latitude: targetPoint.lat, longitude: targetPoint.lng, accuracy: 15, speed: 0 },
                timestamp: Date.now()
            };
            
            onLocationSuccess(simulatedPosition);
            addDebugLog(`å›½é“${roadNumber}å·ã‚¨ãƒªã‚¢ã«ã‚¸ãƒ£ãƒ³ãƒ—: ${targetPoint.name}`);
        }
        
        // åˆæœŸåŒ–
        window.addEventListener('load', function() {
            addDebugLog('ã‚¢ãƒ—ãƒªé–‹å§‹ï¼ˆä¿®å¾©ç‰ˆï¼‰');
            
            setTimeout(() => {
                initMap();
            }, 500);
            
            setTimeout(() => {
                getCurrentLocation();
            }, 2000);
        });
    </script>
</body>
</html>